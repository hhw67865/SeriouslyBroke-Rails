<% cache [current_user, selected_date, current_period, :expenses] do %>
<%# Expenses Chart: Cumulative expense totals with budget line %>
<div class="mb-8">
  <h3 class="text-lg font-medium text-gray-900 mb-4"><%= @presenter.ytd? ? "YTD Spending" : "Monthly Spending" %></h3>
  <div class="bg-gray-50 rounded p-4">
    <% if @presenter.expenses_chart_data.any? %>
      <% chart_data = [
        { name: "Spending", data: @presenter.expenses_chart_data }
      ] %>
      <% if @presenter.budget_line_data.any? %>
        <% chart_data << { name: "Budget", data: @presenter.budget_line_data } %>
      <% end %>
      <%= line_chart chart_data,
          curve: false,
          points: false,
          prefix: "$ ",
          colors: @presenter.expenses_chart_colors %>
    <% else %>
      <p class="text-gray-500 text-center py-8">No expense data <%= period_time_label %></p>
    <% end %>
  </div>
</div>

<%# Summary Stats %>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
  <div class="bg-gray-50 rounded p-4">
    <p class="text-sm text-gray-500"><%= @presenter.ytd? ? "YTD Expenses" : "Total Expenses" %></p>
    <p class="text-2xl font-semibold text-status-danger"><%= number_to_currency(@presenter.total_expenses) %></p>
  </div>
  <% if @presenter.total_budget.positive? %>
    <div class="bg-gray-50 rounded p-4">
      <p class="text-sm text-gray-500"><%= period_budget_label %></p>
      <p class="text-2xl font-semibold text-gray-700"><%= number_to_currency(@presenter.total_budget) %></p>
    </div>
  <% end %>
</div>

<%# Category Breakdown %>
<div>
  <h3 class="text-lg font-medium text-gray-900 mb-4">By Category</h3>
  <% if @presenter.expense_categories_breakdown.any? %>
    <div class="space-y-3">
      <% @presenter.expense_categories_breakdown.each do |cat| %>
        <div class="flex items-center justify-between py-2 border-b border-gray-100">
          <span class="text-gray-700"><%= cat[:name] %></span>
          <span class="font-medium text-gray-900"><%= number_to_currency(cat[:amount]) %></span>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-gray-500">No expenses recorded <%= period_time_label %></p>
  <% end %>
</div>
<% end %>
