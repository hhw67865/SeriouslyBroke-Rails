<% cache [current_user, selected_date, current_period, :savings] do %>
<%# Savings Chart: Cumulative balance %>
<div class="mb-8">
  <h3 class="text-lg font-medium text-gray-900 mb-4">Savings Balance (<%= @presenter.ytd? ? "YTD" : "6 months" %>)</h3>
  <div class="bg-gray-50 rounded p-4">
    <% if @presenter.savings_chart_data.any? %>
      <%= line_chart @presenter.savings_chart_data,
          curve: false,
          points: false,
          prefix: "$ ",
          colors: @presenter.savings_chart_colors %>
    <% else %>
      <p class="text-gray-500 text-center py-8">No savings data available</p>
    <% end %>
  </div>
</div>

<%# Summary Stats %>
<div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-8">
  <div class="bg-gray-50 rounded p-4">
    <p class="text-sm text-gray-500"><%= period_amount_label(:savings) %></p>
    <p class="text-2xl font-semibold text-brand-dark"><%= number_to_currency(@presenter.total_savings_contribution) %></p>
  </div>
  <div class="bg-gray-50 rounded p-4">
    <p class="text-sm text-gray-500">Total Balance</p>
    <p class="text-2xl font-semibold text-brand-dark"><%= number_to_currency(@presenter.total_savings_balance) %></p>
  </div>
</div>

<%# Category Breakdown %>
<div>
  <h3 class="text-lg font-medium text-gray-900 mb-4">By Category</h3>
  <% breakdown = @presenter.savings_categories_breakdown %>
  <% if breakdown.any? %>
    <div class="space-y-3">
      <% breakdown.each do |cat| %>
        <div class="flex items-center justify-between py-2 border-b border-gray-100">
          <div>
            <span class="text-gray-700"><%= cat[:name] %></span>
            <span class="text-sm text-gray-500 ml-2">(Balance: <%= number_to_currency(cat[:balance]) %>)</span>
          </div>
          <span class="font-medium text-gray-900">+<%= number_to_currency(cat[:amount]) %></span>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="text-gray-500">No savings categories</p>
  <% end %>
</div>
<% end %>
