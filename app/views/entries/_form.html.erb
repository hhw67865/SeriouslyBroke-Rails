<%= simple_form_for(entry) do |f| %>
  <%= f.error_notification %>
  <%= f.error_notification message: f.object.errors[:base].to_sentence if f.object.errors[:base].present? %>
  <%= hidden_field_tag :previous_url, @previous_url if @previous_url.present? %>
  <div>
    <%# Transaction Details Section %>
    <div class="bg-white shadow-sm rounded overflow-hidden border border-gray-100 mb-6">
      <div class="p-6">
        <h2 class="text-xl font-semibold mb-4">Transaction Details</h2>
        
        <div data-controller="app--entry--form">
          <%= f.simple_fields_for :item do |df| %>
            <%= df.hidden_field :name, data: { app__entry__form_target: "itemNameField" } %>
          <% end %>

          <div class="form-group">
            <label for="category_id" class="form-label">Category</label>
            <%= select_tag :category_id,
                options_from_collection_for_select(@categories, :id, :name, entry.item&.category_id),
                prompt: "Select a category",
                data: {
                  app__entry__form_target: "categorySelect"
                },
                class: "form-select" %>
          </div>

          <div class="form-group">
            <label for="entry_item_id" class="form-label">Name</label>
            <%= f.select :item_id,
                options_from_collection_for_select(
                  entry.persisted? ? entry.item.category.items : [], 
                  :id, 
                  :name, 
                  entry.item_id
                ),
                { prompt: "Choose a Category first" },
                { 
                  data: { app__entry__form_target: "itemSelect" },
                  class: "form-select"
                } %>
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mt-5">
          <%= f.input :amount,
              as: :decimal,
              placeholder: "0.00",
              hint: "Enter the transaction amount",
              input_html: { 
                step: 0.01,
                min: 0.01
              } %>

          <%= f.input :date,
              as: :string,
              hint: "When did this transaction occur?",
              input_html: {
                type: "date",
                value: entry.date&.strftime("%Y-%m-%d") || Date.current.strftime("%Y-%m-%d")
              } %>
        </div>

        <%= f.input :description,
            placeholder: "Add any notes about this transaction",
            hint: "Optional details about this entry",
            input_html: { rows: 3 } %>
      </div>
    </div>



    <%# Form Actions %>
    <div class="flex flex-col sm:flex-row sm:justify-end gap-3">
      <%= link_to "Cancel",
          @previous_url.present? ? @previous_url : entries_path,
          class: "inline-flex items-center justify-center gap-2 px-4 py-2 rounded border border-gray-300 bg-white text-gray-700 text-sm font-medium hover:bg-gray-50 shadow-sm transition" %>

      <%= f.button :submit,
          entry.persisted? ? "Update Entry" : "Create Entry",
          class: "inline-flex items-center justify-center gap-2 px-4 py-2 rounded bg-brand text-white text-sm font-medium hover:bg-brand-dark shadow-sm transition" %>
    </div>
  </div>
<% end %>
