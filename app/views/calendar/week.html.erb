<% range_label = @week_start.month == @week_end.month ?
  "#{@week_start.strftime('%b %-d')} – #{@week_end.strftime('%-d, %Y')}" :
  "#{@week_start.strftime('%b %-d')} – #{@week_end.strftime('%b %-d, %Y')}" %>

<div class="px-4 sm:px-6 lg:px-8 py-6 font-light">
<div class="flex items-center justify-between mb-6">
  <div class="flex items-center gap-3">
    <%= link_to calendar_path(month: @focused_date.month, year: @focused_date.year),
        class: "inline-flex items-center gap-2 px-3 py-2 rounded-md border border-gray-300 bg-white text-sm hover:bg-gray-100 shadow-sm transition" do %>
      <%= heroicon "arrow-left", options: { class: "w-4 h-4" } %>
      Monthly
    <% end %>
    <h1 class="text-xl font-medium text-gray-900">Week of <%= range_label %></h1>
  </div>
  <div class="flex gap-2">
    <%= link_to calendar_week_path(date: week_nav_date(@focused_date, :prev)),
        class: "inline-flex items-center px-3 py-2 rounded-md border border-gray-300 bg-white hover:bg-gray-100 shadow-sm transition" do %>
      <%= heroicon "chevron-left", options: { class: "w-5 h-5" } %>
    <% end %>
    <%= link_to calendar_week_path(date: week_nav_date(@focused_date, :next)),
        class: "inline-flex items-center px-3 py-2 rounded-md border border-gray-300 bg-white hover:bg-gray-100 shadow-sm transition" do %>
      <%= heroicon "chevron-right", options: { class: "w-5 h-5" } %>
    <% end %>
    <%= link_to new_entry_path,
        class: "ml-3 inline-flex items-center gap-2 px-3 py-2 rounded-md bg-brand text-on-dark hover:bg-brand-dark shadow-sm transition" do %>
      <%= heroicon "plus", options: { class: "w-4 h-4" } %>
      Create Entry
    <% end %>
  </div>
</div>

<div class="calendar-week-columns">
  <% (@week_start..@week_end).each do |day| %>
    <% day_entries = (@week_entries_by_day || {})[day] || [] %>
      <div class="rounded-md border border-gray-200 bg-white p-3 hover:border-gray-300 hover:shadow-sm transition">
        <div class="text-xs text-gray-500"><%= day.strftime('%a') %></div>
        <div class="text-sm font-medium text-gray-900"><%= day.strftime('%-m/%-d') %></div>
        <div class="mt-3 space-y-3">
          <% [[:expense, 'Expense', 'text-status-danger'], [:income, 'Income', 'text-status-success'], [:savings, 'Savings', 'text-brand-dark']].each do |sym, label, color| %>
            <% entries = day_entries.select { |e| e[:type] == sym } %>
            <% next if entries.empty? %>
            <div class="rounded border border-gray-100">
              <div class="flex justify-between px-2.5 py-2 bg-gray-50">
                <div class="text-xs font-light text-gray-600"><%= label %></div>
                <div class="text-xs font-semibold <%= color %>"><%= sym == :expense ? '-' : '+' %><%= format_currency(entries.sum { |e| e[:amount].to_i }) %></div>
              </div>
              <ul>
                <% entries.each do |e| %>
                  <li class="px-2.5 py-2 text-xs border-b border-gray-100 last:border-b-0">
                    <div class="text-gray-700 mb-1"><%= e[:name] %></div>
                    <div class="font-medium <%= color %>"><%= sym == :expense ? '-' : '+' %><%= format_currency(e[:amount]) %></div>
                  </li>
                <% end %>
              </ul>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>